<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0">
    <title>Basic calendar</title>

    <link rel="stylesheet" href="../build/calendar.min.css" type="text/css" />
    <style>
        .container {
            margin: 80px auto;
            max-width: 400px;
        }
        .calendar1 {

        }
        .calendar1,
        .calendar2 {
            margin-bottom: 20px;
        }
        form,
        .action {
            margin-top: 20px;
        }
        form h4,
        .action h4 {
            margin-bottom: 0;
        }

        .wbcalendar--selected {
            background-color: #efefef;
        }
        .wbcalendar--period-in {
            background-color: rgb(217, 180, 252);
        }
        .wbcalendar--period-start {
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
        }
        .wbcalendar--period-end {
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="calendar1"></div>
        <div class="calendar2"></div>

        <div class="action">
            <h4>Calendar1 set select period</h4>
            <button name="calendar1_setselectperiod">Set select period</button><br />
            <button name="calendar1_unsetselectperiod">Unset select period</button>
        </div>

        <div class="action">
            <h4>Calendar2 set select period</h4>
            <button name="calendar2_setselectperiod">Set select period</button><br />
            <button name="calendar2_unsetselectperiod">Unset select period</button>
        </div>

        <form id="setdate">
            <h4>Set date</h4>
            <input type="text" name="date" value="2023-02-01" />
            <button type="submit">Set</button>
        </form>

        <form id="setselecteddate">
            <h4>Set selected date</h4>
            <input type="text" name="date" value="2023-05-11" />
            <button type="submit">Set</button>
        </form>

        <form id="getdate">
            <h4>Get date</h4>
            <input type="text" name="date" />
            <button type="submit">Get</button>
        </form>

        <form id="getselecteddate">
            <h4>Get selected date</h4>
            <input type="text" name="date" />
            <button type="submit">Get</button>
        </form>

        <form id="getselectedperiod">
            <h4>Get selected period</h4>
            <textarea name="date"></textarea>
            <button type="submit">Get</button>
        </form>
    </div>

    <script src="./dom-helpers.min.js"></script>
    <script src="../build/calendar.min.js"></script>

    <script>

        let Calendar = window.webit.calendar.default;

        let calendar1 = new Calendar.dom(new Date(), {
            view: 'week',
            count: 1,
        });
        calendar1.on('dateclick', date => {
            console.log('week date click', date);
        })
        document.querySelector('.calendar1').appendChild(calendar1.getEl())

        calendar1.setSelectedDate(new Date());


        let calendar2 = new Calendar.dom(new Date(), {
            //cssprefix: '',
            view: 'month',
            count: 1,
            showWeekdays: true,
            showDateSwitch: true,
            showToday: false,
            // pazīme, ka jāļauj atzīmēt period
            selectPeriod: true,
            selectedPeriod: {
                from: new Date('2023-05-10 00:00:00'),
                till: new Date('2023-05-22 23:59:59')
            },
            monthDayFormatter: function(date, el, dateState){

                if (!el) {
                    el = document.createElement('div');
                    el.innerHTML = date.getDate();
                    return el;
                }

                el.innerHTML = date.getDate()+(dateState ? dateState : '');
            }//,
            // weekDayToText: function(dayIndex) {
            //     return ['', 'P', 'O', 'T', 'C', 'Pk', 'S', 'Sv'][dayIndex];
            // }
        });

        calendar2.setSelectedPeriod({
            from: new Date('2023-05-08 00:00:00'),
            till: new Date('2023-05-12 23:59:59')
        });

        // setInterval(function(){
        //     calendar2.setState({
        //         '2023-05-20': (new Date().getTime()+'').substring(11, 12),
        //         '2023-05-21': 'b'
        //     })
        // }, 2000)

        calendar2.on('periodselect', period => {
            console.log('periodselect');
            console.log(period)
        });

        // calendar2.on('dateclick', date => {
        //     console.log('dateclick');
        //     console.log(date)
        // });
        // calendar2.on('slidechange', date => {
        //     console.log('slidechange');
        //     console.log(date)
        // });
        // calendar2.on('slideschange', dates => {
        //     console.log('slideschange');
        //     console.log(dates)
        // });


        document.querySelector('.calendar2').appendChild(calendar2.getEl())

        var helpers = window.webit.domHelpers;

        helpers.submitp('#setdate', (ev, el) => {
            let data = helpers.getFormData(el);

            calendar1.setDate(new Date(data.date));
            calendar2.setDate(new Date(data.date));
        })

        helpers.submitp('#setselecteddate', (ev, el) => {
            let data = helpers.getFormData(el);

            calendar1.setSelectedDate(new Date(data.date));
            calendar2.setSelectedDate(new Date(data.date));
        })

        helpers.submitp('#getdate', (ev, el) => {
            helpers.setFormData(el, {
                date: calendar2.getDate()
            })
        })

        helpers.submitp('#getselecteddate', (ev, el) => {
            helpers.setFormData(el, {
                date: calendar2.getSelectedDate()
            })
        })

        helpers.submitp('#getselectedperiod', (ev, el) => {
            var p = calendar2.getSelectedPeriod();
            helpers.setFormData(el, {
                date: p ? p.from + "\n\n" + p.till : null
            })
        })

        helpers.click('[name=calendar1_setselectperiod]', () => {
            calendar1.setSelectPeriod(true);
        })
        helpers.click('[name=calendar1_unsetselectperiod]', () => {
            calendar1.setSelectPeriod(false);
        })

        helpers.click('[name=calendar2_setselectperiod]', () => {
            calendar2.setSelectPeriod(true);
        })
        helpers.click('[name=calendar2_unsetselectperiod]', () => {
            calendar2.setSelectPeriod(false);
        })

    </script>
</body>
</html>